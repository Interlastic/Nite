<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Pixie Pet - Virtual Pet</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Press Start 2P', monospace;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    #root { min-height: 100vh; }
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .pet-emoji { font-size: 60px; margin-bottom: 20px; animation: bounce 1s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-20px)} }
    .error { color: #ff6b6b; margin-top: 20px; font-size: 10px; }
  </style>
</head>
<body>
  <div id="root">
    <div class="loading">
      <div class="pet-emoji">üê£</div>
      <p>Loading Pixie Pet...</p>
    </div>
  </div>

  <!-- React via CDN with fallback -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <script>
    // Simple error handling
    window.onerror = function(msg, url, line) {
      console.error('Error:', msg);
      document.getElementById('root').innerHTML = 
        '<div style="padding:20px;color:white;text-align:center;font-size:10px;">Error loading app. Please refresh.</div>';
    };
  </script>

  <script>
    (function() {
      'use strict';
      var React = window.React;
      var ReactDOM = window.ReactDOM;
      
      if (!React || !ReactDOM) {
        document.getElementById('root').innerHTML = 
          '<div class="loading"><p>Failed to load React. Check connection.</p></div>';
        return;
      }

      var useState = React.useState;
      var useEffect = React.useEffect;
      var useCallback = React.useCallback;

      // Game constants
      var CONFIG = {
        TICK: 1000,
        MAX: 100,
        CRITICAL: 20
      };

      var DECAY = { hunger: 2, happy: 1.5, energy: 1.8, health: 0.5, clean: 1.2 };
      var FOOD = { apple: { h: 20, cost: 5 }, burger: { h: 35, cost: 8 } };

      // Main App
      function App() {
        var _useState = useState(function() {
          try {
            var saved = localStorage.getItem('pixiepet_save');
            return saved ? JSON.parse(saved) : {
              stats: { hunger: 80, happy: 80, energy: 80, health: 100, clean: 100 },
              coins: 100, age: 0, stage: 'egg', sleeping: false,
              createdAt: Date.now(), lastSave: Date.now()
            };
          } catch(e) { return null; }
        });
        var state = _useState[0];
        var setState = _useState[1];
        
        var _useState2 = useState(null);
        var msg = _useState2[0];
        var setMsg = _useState2[1];

        // Save on change
        useEffect(function() {
          if (state) {
            localStorage.setItem('pixiepet_save', JSON.stringify(state));
          }
        }, [state]);

        // Game loop
        useEffect(function() {
          var timer = setInterval(function() {
            setState(function(s) {
              if (!s || s.sleeping) return s;
              var newStats = {
                hunger: Math.max(0, s.stats.hunger - DECAY.hunger),
                happy: Math.max(0, s.stats.happy - DECAY.happy),
                energy: Math.max(0, s.stats.energy - DECAY.energy),
                health: Math.max(0, s.stats.health - DECAY.health),
                clean: Math.max(0, s.stats.clean - DECAY.clean)
              };
              var newAge = s.age + 1;
              var stage = newAge < 30 ? 'egg' : newAge < 300 ? 'baby' : newAge < 900 ? 'child' : 'adult';
              return Object.assign({}, s, { stats: newStats, age: newAge, stage: stage });
            });
          }, CONFIG.TICK);
          return function() { return clearInterval(timer); };
        }, []);

        // Helper functions
        var color = function(v) { return v <= 20 ? '#e74c3c' : v <= 40 ? '#f39c12' : '#2ecc71'; };
        var emoji = function() { 
          return state.stage === 'egg' ? 'ü•ö' : 
                 state.stage === 'baby' ? 'üê£' : 
                 state.stage === 'child' ? 'üê•' : 'üêî'; 
        };
        var petState = function() {
          if (state.stats.health <= 0) return 'dead';
          if (state.sleeping) return 'sleeping';
          if (state.stats.hunger <= 20) return 'hungry';
          if (state.stats.happy <= 20) return 'sad';
          if (state.stats.happy > 70) return 'happy';
          return 'idle';
        };

        var act = function(type) {
          var actions = {
            feed: function(s) { 
              if (s.coins < 5) return s; 
              return Object.assign({}, s, { 
                coins: s.coins - 5, 
                stats: Object.assign({}, s.stats, { hunger: Math.min(100, s.stats.hunger + 25) }) 
              });
            },
            play: function(s) { 
              if (s.sleeping || s.coins < 5) return s; 
              return Object.assign({}, s, { 
                coins: s.coins - 5,
                stats: Object.assign({}, s.stats, { happy: Math.min(100, s.stats.happy + 25), energy: Math.max(0, s.stats.energy - 15) })
              });
            },
            clean: function(s) { 
              if (s.coins < 3) return s;
              return Object.assign({}, s, { 
                coins: s.coins - 3,
                stats: Object.assign({}, s.stats, { clean: 100 })
              });
            },
            cure: function(s) {
              if (s.coins < 10) return s;
              return Object.assign({}, s, {
                coins: s.coins - 10,
                stats: Object.assign({}, s.stats, { health: Math.min(100, s.stats.health + 40) })
              });
            },
            sleep: function(s) { return Object.assign({}, s, { sleeping: !s.sleeping }); },
            earn: function(s) { return Object.assign({}, s, { coins: s.coins + 20 }); }
          };
          
          if (actions[type]) {
            setState(actions[type](state));
            setMsg(type);
            setTimeout(function() { return setMsg(null); }, 1500);
          }
        };

        var fmtTime = function(s) { return Math.floor(s/60) + 'm ' + (s%60) + 's'; };
        var ps = petState();
        var isDead = ps === 'dead';

        if (!state) {
          return React.createElement('div', { className: 'loading' }, 
            React.createElement('p', null, 'Error loading save data.')
          );
        }

        return React.createElement('div', { style: { padding: '12px', maxWidth: '400px', margin: '0 auto' } },
          // Header
          React.createElement('div', { style: { background: 'white', borderRadius: '12px', padding: '12px', marginBottom: '12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' } },
            React.createElement('div', null,
              React.createElement('h2', { style: { fontSize: '12px', color: '#667eea', margin: 0 } }, 'üéÄ Pixie Pet'),
              React.createElement('p', { style: { fontSize: '7px', color: '#636e72', margin: '4px 0 0' } }, state.stage.toUpperCase() + ' | ' + fmtTime(state.age))
            ),
            React.createElement('div', { style: { fontSize: '14px' } }, 'ü™ô ' + state.coins)
          ),

          // Pet
          React.createElement('div', { style: {
            aspectRatio: '1', borderRadius: '16px', marginBottom: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative',
            background: state.sleeping ? '#2d3436' : isDead ? '#636e72' : '#74b9ff'
          }},
            React.createElement('span', { style: { fontSize: '64px', filter: isDead ? 'grayscale(1)' : 'none' } }, emoji()),
            msg && React.createElement('div', { style: { position: 'absolute', top: '10px', background: 'white', padding: '6px 12px', borderRadius: '12px', fontSize: '7px' }},
              { feed: 'Yummy! üçñ', play: 'Fun! üéÆ', clean: 'Clean! ‚ú®', cure: 'Better! üíä', sleep: state.sleeping ? 'Good night! üí§' : 'Morning! ‚òÄÔ∏è', earn: '+20 coins! ü™ô' }[msg]
            )
          ),

          // Stats
          React.createElement('div', { style: { background: 'white', borderRadius: '12px', padding: '10px', marginBottom: '12px' }},
            Object.entries(state.stats).map(function(kv) {
              var icons = { hunger: 'üçñ', happy: 'üòä', energy: '‚ö°', health: '‚ù§Ô∏è', clean: '‚ú®' };
              return React.createElement('div', { key: kv[0], style: { display: 'flex', alignItems: 'center', gap: '6px', marginBottom: '6px' }},
                React.createElement('span', { style: { fontSize: '11px' } }, icons[kv[0]] || 'üìä'),
                React.createElement('div', { style: { flex: 1, height: '10px', background: '#eee', borderRadius: '5px', overflow: 'hidden' }},
                  React.createElement('div', { style: { width: kv[1] + '%', height: '100%', background: color(kv[1]), transition: 'all 0.3s' }})
                ),
                React.createElement('span', { style: { fontSize: '7px', minWidth: '20px', textAlign: 'right' }}, Math.round(kv[1]))
              );
            })
          ),

          // Actions
          !isDead ? React.createElement('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(3,1fr)', gap: '8px' }},
            React.createElement('button', { onClick: function() { return act('feed'); }, disabled: state.sleeping, style: btnStyle('#e17055', state.sleeping) }, 'üçñ Feed (5)'),
            React.createElement('button', { onClick: function() { return act('play'); }, disabled: state.sleeping, style: btnStyle('#00b894', state.sleeping) }, 'üéÆ Play (5)'),
            React.createElement('button', { onClick: function() { return act('clean'); }, style: btnStyle('#74b9ff') }, 'üßπ Clean (3)'),
            React.createElement('button', { onClick: function() { return act('sleep'); }, style: btnStyle('#6c5ce7') }, state.sleeping ? '‚òÄÔ∏è Wake' : 'üí§ Sleep'),
            React.createElement('button', { onClick: function() { return act('cure'); }, style: btnStyle('#fd79a8') }, 'üíä Cure (10)'),
            React.createElement('button', { onClick: function() { return act('earn'); }, style: btnStyle('#f1c40f') }, 'üé≤ Earn')
          ) : React.createElement('div', { style: { background: '#e74c3c', borderRadius: '12px', padding: '16px', textAlign: 'center', color: 'white' }},
            React.createElement('p', { style: { fontSize: '9px', margin: 0 }}, 'üíî Your pet passed away'),
            React.createElement('p', { style: { fontSize: '7px', margin: '4px 0 12px' }}, 'Age: ' + fmtTime(state.age)),
            React.createElement('button', { onClick: function() {
              localStorage.removeItem('pixiepet_save');
              window.location.reload();
            }, style: { background: 'white', border: 'none', borderRadius: '8px', padding: '10px 20px', fontSize: '8px', cursor: 'pointer' }}, 'üîÑ New Pet')
          )
        );
      }

      function btnStyle(bg, disabled) {
        return {
          background: bg,
          border: 'none',
          borderRadius: '10px',
          padding: '12px 6px',
          fontSize: '7px',
          color: 'white',
          cursor: disabled ? 'not-allowed' : 'pointer',
          opacity: disabled ? 0.5 : 1
        };
      }

      // Render
      try {
        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
      } catch(e) {
        console.error('Render error:', e);
        document.getElementById('root').innerHTML = '<div class="loading error">Render error. Please refresh.</div>';
      }
    })();
  </script>
</body>
</html>