<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Interactive Music Visualizer & Sequencer Playground - Create beats in your browser">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="assets/icon.svg">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <title>BeatForge - Music Visualizer & Sequencer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">♪</span>
                <h1>BeatForge</h1>
            </div>
            <div class="header-controls">
                <button id="installBtn" class="btn btn-install hidden" aria-label="Install App">
                    <span>Install App</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Visualization Section -->
            <section class="visualization-section">
                <div class="viz-controls">
                    <button class="viz-btn active" data-viz="waveform" title="Waveform">∿</button>
                    <button class="viz-btn" data-viz="spectrum" title="Spectrum">▤</button>
                    <button class="viz-btn" data-viz="circular" title="Circular">◎</button>
                    <button class="viz-btn" data-viz="particles" title="Particles">✦</button>
                </div>
                <canvas id="visualizer" class="visualizer-canvas"></canvas>
            </section>

            <!-- Transport Controls -->
            <section class="transport-section">
                <div class="transport-controls">
                    <button id="playBtn" class="btn btn-play" title="Play/Pause">
                        <span class="play-icon">▶</span>
                        <span class="pause-icon hidden">❚❚</span>
                    </button>
                    <button id="stopBtn" class="btn btn-stop" title="Stop">■</button>
                    <button id="recordBtn" class="btn btn-record" title="Record">●</button>
                </div>
                <div class="tempo-control">
                    <label for="tempoSlider">BPM</label>
                    <input type="range" id="tempoSlider" min="60" max="200" value="120">
                    <span id="tempoValue">120</span>
                </div>
                <div class="swing-control">
                    <label for="swingSlider">Swing</label>
                    <input type="range" id="swingSlider" min="0" max="100" value="0">
                    <span id="swingValue">0%</span>
                </div>
                <div class="step-control">
                    <label>Steps</label>
                    <button class="step-btn" data-steps="16">16</button>
                    <button class="step-btn active" data-steps="32">32</button>
                    <button class="step-btn" data-steps="64">64</button>
                </div>
            </section>

            <!-- Step Sequencer -->
            <section class="sequencer-section">
                <div class="sequencer-header">
                    <div class="track-labels">
                        <div class="label-spacer"></div>
                    </div>
                    <div class="step-indicators" id="stepIndicators"></div>
                </div>
                <div class="sequencer-grid" id="sequencerGrid">
                    <!-- Tracks will be generated by JavaScript -->
                </div>
            </section>

            <!-- Mixer Section -->
            <section class="mixer-section">
                <h3>Mixer</h3>
                <div class="mixer-controls" id="mixerControls">
                    <!-- Mixer strips will be generated by JavaScript -->
                </div>
            </section>

            <!-- Pattern Management -->
            <section class="pattern-section">
                <div class="pattern-controls">
                    <h3>Patterns</h3>
                    <div class="pattern-buttons">
                        <button class="pattern-btn active" data-pattern="A">A</button>
                        <button class="pattern-btn" data-pattern="B">B</button>
                        <button class="pattern-btn" data-pattern="C">C</button>
                        <button class="pattern-btn" data-pattern="D">D</button>
                    </div>
                    <div class="pattern-actions">
                        <button id="copyPattern" class="btn btn-small">Copy</button>
                        <button id="pastePattern" class="btn btn-small">Paste</button>
                        <button id="clearPattern" class="btn btn-small">Clear</button>
                        <button id="randomizePattern" class="btn btn-small">Random</button>
                    </div>
                </div>
                <div class="chain-section">
                    <h3>Song Chain</h3>
                    <div class="chain-controls">
                        <input type="text" id="chainInput" placeholder="A-A-B-A-C-B" value="A">
                        <button id="playChain" class="btn btn-small">Play Chain</button>
                    </div>
                </div>
                <div class="save-load-section">
                    <button id="saveProject" class="btn btn-small">Save Project</button>
                    <button id="loadProject" class="btn btn-small">Load Project</button>
                    <button id="exportWav" class="btn btn-small">Export WAV</button>
                </div>
            </section>

            <!-- Synth Settings Panel -->
            <section class="synth-panel">
                <h3>Synth Settings <button id="toggleSynth" class="toggle-btn">−</button></h3>
                <div class="synth-content" id="synthContent">
                    <div class="synth-controls">
                        <div class="control-group">
                            <label>Oscillator</label>
                            <select id="oscType">
                                <option value="sine">Sine</option>
                                <option value="square">Square</option>
                                <option value="sawtooth">Sawtooth</option>
                                <option value="triangle">Triangle</option>
                            </select>
                        </div>
                        <div class="adsr-controls">
                            <h4>ADSR Envelope</h4>
                            <div class="knob-row">
                                <div class="knob">
                                    <label>A</label>
                                    <input type="range" id="attack" min="0" max="100" value="10">
                                    <span id="attackVal">0.01s</span>
                                </div>
                                <div class="knob">
                                    <label>D</label>
                                    <input type="range" id="decay" min="0" max="100" value="30">
                                    <span id="decayVal">0.3s</span>
                                </div>
                                <div class="knob">
                                    <label>S</label>
                                    <input type="range" id="sustain" min="0" max="100" value="70">
                                    <span id="sustainVal">70%</span>
                                </div>
                                <div class="knob">
                                    <label>R</label>
                                    <input type="range" id="release" min="0" max="100" value="30">
                                    <span id="releaseVal">0.3s</span>
                                </div>
                            </div>
                        </div>
                        <div class="filter-controls">
                            <h4>Filter</h4>
                            <div class="filter-row">
                                <select id="filterType">
                                    <option value="lowpass">Low Pass</option>
                                    <option value="highpass">High Pass</option>
                                    <option value="bandpass">Band Pass</option>
                                    <option value="notch">Notch</option>
                                </select>
                                <div class="knob">
                                    <label>Cutoff</label>
                                    <input type="range" id="filterCutoff" min="20" max="20000" value="5000">
                                    <span id="cutoffVal">5000Hz</span>
                                </div>
                                <div class="knob">
                                    <label>Res</label>
                                    <input type="range" id="filterRes" min="0" max="100" value="10">
                                    <span id="resVal">10</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Effects Panel -->
            <section class="effects-panel">
                <h3>Effects <button id="toggleEffects" class="toggle-btn">−</button></h3>
                <div class="effects-content" id="effectsContent">
                    <div class="effect-controls">
                        <div class="effect-unit">
                            <h4>Reverb</h4>
                            <label class="toggle-label">
                                <input type="checkbox" id="reverbEnabled">
                                <span class="toggle-switch"></span>
                            </label>
                            <div class="knob">
                                <label>Decay</label>
                                <input type="range" id="reverbDecay" min="0" max="100" value="50">
                            </div>
                            <div class="knob">
                                <label>Mix</label>
                                <input type="range" id="reverbMix" min="0" max="100" value="30">
                            </div>
                        </div>
                        <div class="effect-unit">
                            <h4>Delay</h4>
                            <label class="toggle-label">
                                <input type="checkbox" id="delayEnabled">
                                <span class="toggle-switch"></span>
                            </label>
                            <div class="knob">
                                <label>Time</label>
                                <input type="range" id="delayTime" min="0" max="100" value="30">
                            </div>
                            <div class="knob">
                                <label>Feedback</label>
                                <input type="range" id="delayFeedback" min="0" max="100" value="40">
                            </div>
                            <div class="knob">
                                <label>Mix</label>
                                <input type="range" id="delayMix" min="0" max="100" value="20">
                            </div>
                        </div>
                        <div class="effect-unit">
                            <h4>Distortion</h4>
                            <label class="toggle-label">
                                <input type="checkbox" id="distortionEnabled">
                                <span class="toggle-switch"></span>
                            </label>
                            <div class="knob">
                                <label>Drive</label>
                                <input type="range" id="distortionDrive" min="0" max="100" value="20">
                            </div>
                            <div class="knob">
                                <label>Mix</label>
                                <input type="range" id="distortionMix" min="0" max="100" value="50">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Keyboard Section -->
            <section class="keyboard-section">
                <h3>Live Input <span class="hint">(Use keys A-L for piano)</span></h3>
                <div class="piano-keyboard" id="pianoKeyboard">
                    <!-- Keys will be generated by JavaScript -->
                </div>
            </section>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="statusText">Ready</span>
            </div>
            <div class="status-center">
                <span id="currentStep">Step: 1</span>
                <span id="currentPattern">Pattern: A</span>
            </div>
            <div class="status-right">
                <span id="cpuMeter">CPU: 0%</span>
            </div>
        </footer>
    </div>

    <!-- Audio Engine -->
    <script src="audio-engine.js"></script>
    <!-- Visualization -->
    <script src="visualizer.js"></script>
    <!-- Sequencer -->
    <script src="sequencer.js"></script>
    <!-- UI Controller -->
    <script src="ui-controller.js"></script>
    <!-- PWA Registration -->
    <script src="app.js"></script>
</body>
</html>